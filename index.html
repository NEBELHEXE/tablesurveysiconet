<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>Tickets Siconet</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="tablesurveysiconet.css">
</head>
<body>
    <h1>Tickets Siconet</h1>

    <!-- Input para filtrar por ID -->
    <input type="text" id="filterInput" placeholder="Filtrar por ID... (ejemplo: ID-abc123xyz)" />

    <!-- Tabla para mostrar tickets -->
    <table id="ticketsTable" border="1" cellpadding="5" cellspacing="0">
        <thead>
            <tr>
                <th>Empresa</th>
                <th>Fecha</th>
                <th>ID</th>
                <th>Nivel de Urgencia</th>
                <th>Descripción</th>
            </tr>
        </thead>
        <tbody>
            <!-- Aquí se insertarán filas dinámicamente -->
        </tbody>
    </table>

    <div id="no-results" style="display:none; color: red; font-weight: bold; margin-top: 10px;">No se encontraron tickets que coincidan.</div>

    <script>
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSwPOv6OSSiCi4vdm5JPIwV9WcEldyurM5pxlc7uZBYMDPO0w9GskfCR6I8AblnURWWNs7QnIuNDSBb/pub?output=csv';

        const tableBody = document.querySelector('#ticketsTable tbody');
        const filterInput = document.getElementById('filterInput');
        const noResultsDiv = document.getElementById('no-results');

        function parseCSV(text) {
            const lines = text.trim().split('\n');
            return lines.map(line => line.split(','));
        }

        async function loadTickets() {
            try {
                const response = await fetch(csvUrl);
                const csvText = await response.text();
                const data = parseCSV(csvText);

                const headers = data[0];
                const rows = data.slice(1);

                tableBody.innerHTML = '';
                window.ticketData = rows;
                displayRows(rows);
            } catch (error) {
                tableBody.innerHTML = `<tr><td colspan="5">Error cargando datos: ${error.message}</td></tr>`;
            }
        }

        function displayRows(rows) {
            tableBody.innerHTML = '';
            if (rows.length === 0) {
                noResultsDiv.style.display = 'block';
                return;
            } else {
                noResultsDiv.style.display = 'none';
            }
            for (const row of rows) {
                const [empresa, fecha, id, urgencia, descripcion] = row;

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${empresa}</td>
                    <td>${fecha}</td>
                    <td>${id}</td>
                    <td>${urgencia}</td>
                    <td>${descripcion}</td>
                `;
                tableBody.appendChild(tr);
            }
        }

        filterInput.addEventListener('input', () => {
            const filterValue = filterInput.value.trim().toLowerCase();
            if (!window.ticketData) return;

            if (filterValue === '') {
                displayRows(window.ticketData);
            } else {
                const filtered = window.ticketData.filter(row => {
                    const id = row[2].toLowerCase();
                    return id.includes(filterValue);
                });
                displayRows(filtered);
            }
        });

        loadTickets();
    </script>
</body>
</html>
